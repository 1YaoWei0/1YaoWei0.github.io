<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">
<link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/Dynamics365_scalable.svg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/Dynamics365_scalable.svg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/Dynamics365_scalable.svg">
  <link rel="mask-icon" href="/images/Dynamics365_scalable.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Times+New+Roman:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap&subset=latin,latin-ext">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha256-dABdfBfUoC8vJUBOwGVdm8L9qlMWaHTIfXt+7GnZCIo=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"1yaowei0.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":true,"version":"8.22.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"always","padding":1,"offset":1},"hljswrap":true,"copycode":{"enable":true,"style":null},"fold":{"enable":true,"height":500},"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null},"stickytabs":true,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Create ledger journals in D365FO using X++">
<meta property="og:type" content="article">
<meta property="og:title" content="Create ledger journals in D365FO using X++">
<meta property="og:url" content="https://1yaowei0.github.io/2025/07/09/xpp-createledgerjournals/index.html">
<meta property="og:site_name" content="DYNAMICS 365 FINANCE AND OPERATIONS BLOGS">
<meta property="og:description" content="Create ledger journals in D365FO using X++">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://1yaowei0.github.io/2025/07/09/xpp-createledgerjournals/CopyJournalDialog.png">
<meta property="article:published_time" content="2025-07-09T11:39:27.000Z">
<meta property="article:modified_time" content="2025-12-26T03:11:02.922Z">
<meta property="article:author" content="Willie Yao">
<meta property="article:tag" content="LedgerJournalTrans">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://1yaowei0.github.io/2025/07/09/xpp-createledgerjournals/CopyJournalDialog.png">


<link rel="canonical" href="https://1yaowei0.github.io/2025/07/09/xpp-createledgerjournals/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://1yaowei0.github.io/2025/07/09/xpp-createledgerjournals/","path":"2025/07/09/xpp-createledgerjournals/","title":"Create ledger journals in D365FO using X++"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Create ledger journals in D365FO using X++ | DYNAMICS 365 FINANCE AND OPERATIONS BLOGS</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">DYNAMICS 365 FINANCE AND OPERATIONS BLOGS</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">D365 F&O BLOGS</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">22</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">3</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">27</span></a></li><li class="menu-item menu-item-hmt"><a href="/HMT-page/" rel="section"><i class="fa fa-sitemap fa-fw"></i>HMT</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Test-scenario"><span class="nav-number">1.</span> <span class="nav-text">Test scenario</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LedgerJournalEngine-class"><span class="nav-number">2.</span> <span class="nav-text">LedgerJournalEngine class</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#LedgerJournalTrans-defaultRow-method"><span class="nav-number">3.</span> <span class="nav-text">LedgerJournalTrans defaultRow() method</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Data-entity"><span class="nav-number">4.</span> <span class="nav-text">Data entity</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Performance-testing"><span class="nav-number">5.</span> <span class="nav-text">Performance testing</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Choosing-the-right-method-and-things-to-avoid"><span class="nav-number">6.</span> <span class="nav-text">Choosing the right method and things to avoid</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Summary"><span class="nav-number">7.</span> <span class="nav-text">Summary</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Willie Yao"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Willie Yao</p>
  <div class="site-description" itemprop="description">Expert insights on finance, supply chain, automation, and upgrades for Microsoft Dynamics 365 Finance & Operations. Maximize efficiency today!</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">27</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">22</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/1YaoWei0" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;1YaoWei0" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i></a>
      </span>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="Back to top">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://1yaowei0.github.io/2025/07/09/xpp-createledgerjournals/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Willie Yao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="DYNAMICS 365 FINANCE AND OPERATIONS BLOGS">
      <meta itemprop="description" content="Expert insights on finance, supply chain, automation, and upgrades for Microsoft Dynamics 365 Finance & Operations. Maximize efficiency today!">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Create ledger journals in D365FO using X++ | DYNAMICS 365 FINANCE AND OPERATIONS BLOGS">
      <meta itemprop="description" content="Create ledger journals in D365FO using X++">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Create ledger journals in D365FO using X++
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2025-07-09 19:39:27" itemprop="dateCreated datePublished" datetime="2025-07-09T19:39:27+08:00">2025-07-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-12-26 11:11:02" itemprop="dateModified" datetime="2025-12-26T11:11:02+08:00">2025-12-26</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/x/" itemprop="url" rel="index"><span itemprop="name">x++</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">Create ledger journals in D365FO using X++</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><blockquote>
<p>Reprinted from: <a target="_blank" rel="noopener" href="https://denistrunin.com/xpptools-createledgerjournal/">https://denistrunin.com/xpptools-createledgerjournal/</a></p>
</blockquote>
<p>Creating LedgerJournalTrans using X++ is quite a common task, but sometimes I still see some mistakes(mostly related to fields initialization from account&#x2F;offset account and voucher assignment). In this post, I’ll try to describe possible options how to create ledger journals in D365FO.</p>
<h2 id="Test-scenario"><a href="#Test-scenario" class="headerlink" title="Test scenario"></a>Test scenario</h2><p>To test different methods, I wrote a Runnable class DEVTutorialCreateLedgerJournal that creates a new journal based on the data from the existing source journal using different methods. The dialog looks like this</p>
<img src="/2025/07/09/xpp-createledgerjournals/CopyJournalDialog.png" class="" title="CopyJournalDialog">

<p>Let’s discuss possible copy options(Copy type parameter):</p>
<h2 id="LedgerJournalEngine-class"><a href="#LedgerJournalEngine-class" class="headerlink" title="LedgerJournalEngine class"></a>LedgerJournalEngine class</h2><p>This method is using LedgerJournalEngine class - the same class that is used when the user creates a journal manually on the Journal lines form. This increases the chances that the resulting line will be the same as a manually created line.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="keyword">select</span> ledgerJournalTransOrig</span><br><span class="line">    order <span class="keyword">by</span> RecId</span><br><span class="line">            <span class="keyword">where</span> ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum</span><br><span class="line">&#123;</span><br><span class="line">    numLines++;</span><br><span class="line">    <span class="keyword">if</span> (!ledgerJournalTable.RecId)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//Often journal name from parameters is specified here</span></span><br><span class="line">        DEV::validateCursorField(ledgerJournalName, fieldNum(LedgerJournalName, JournalName));</span><br><span class="line"></span><br><span class="line">        ledgerJournalTable.clear();</span><br><span class="line">        ledgerJournalTable.initValue();</span><br><span class="line">        ledgerJournalTable.JournalName = ledgerJournalName.JournalName;</span><br><span class="line">        ledgerJournalTable.initFromLedgerJournalName();</span><br><span class="line">        ledgerJournalTable.JournalNum = JournalTableData::newTable(ledgerJournalTable).nextJournalId();</span><br><span class="line">        ledgerJournalTable.Name = strFmt(<span class="string">&quot;Copy of %1, Date %2&quot;</span>, _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());</span><br><span class="line">        ledgerJournalTable.insert();</span><br><span class="line"></span><br><span class="line">        info(strFmt(<span class="string">&quot;Journal %1 created&quot;</span>, ledgerJournalTable.JournalNum));</span><br><span class="line"></span><br><span class="line">        ledgerJournalEngine = LedgerJournalEngine::construct(ledgerJournalTable.JournalType);</span><br><span class="line">        ledgerJournalEngine.newJournalActive(ledgerJournalTable);    &#125;</span><br><span class="line"></span><br><span class="line">    ledgerJournalTrans.clear();</span><br><span class="line">    ledgerJournalTrans.initValue();</span><br><span class="line">    ledgerJournalEngine.initValue(ledgerJournalTrans);</span><br><span class="line">    ledgerJournalTrans.JournalNum           =   ledgerJournalTable.JournalNum;</span><br><span class="line">    ledgerJournalTrans.TransDate            =   DEV::systemdateget();</span><br><span class="line">    ledgerJournalTrans.AccountType          =   ledgerJournalTransOrig.AccountType;</span><br><span class="line">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, AccountType));</span><br><span class="line"></span><br><span class="line">    ledgerJournalTrans.LedgerDimension = ledgerJournalTransOrig.LedgerDimension;</span><br><span class="line">    <span class="keyword">if</span> (!ledgerJournalTrans.LedgerDimension)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">throw</span> error(<span class="string">&quot;Missing or invalid ledger dimension for journal process&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, LedgerDimension));</span><br><span class="line">    ledgerJournalEngine.accountModified(LedgerJournalTrans);</span><br><span class="line">    ledgerJournalTrans.OffsetAccountType = ledgerJournalTransOrig.OffsetAccountType;</span><br><span class="line">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, OffsetAccountType));</span><br><span class="line">    ledgerJournalTrans.OffsetLedgerDimension = ledgerJournalTransOrig.OffsetLedgerDimension;</span><br><span class="line">    ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, OffsetLedgerDimension));</span><br><span class="line">    ledgerJournalEngine.offsetAccountModified(ledgerJournalTrans);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//amounts</span></span><br><span class="line">    LedgerJournalTrans.CurrencyCode         =   ledgerJournalTransOrig.CurrencyCode;</span><br><span class="line">    ledgerJournalEngine.currencyModified(LedgerJournalTrans);</span><br><span class="line">    LedgerJournalTrans.AmountCurCredit      =   ledgerJournalTransOrig.AmountCurCredit;</span><br><span class="line">    LedgerJournalTrans.AmountCurDebit       =   ledgerJournalTransOrig.AmountCurDebit;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//additional fields</span></span><br><span class="line">    LedgerJournalTrans.Approver           = HcmWorker::userId2Worker(curuserid());</span><br><span class="line">    LedgerJournalTrans.Approved           = NoYes::Yes;</span><br><span class="line">    ledgerJournalTrans.Txt                = ledgerJournalTransOrig.Txt;</span><br><span class="line">    LedgerJournalTrans.SkipBlockedForManualEntryCheck = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    DEV::validateWriteRecordCheck(ledgerJournalTrans);</span><br><span class="line">    ledgerJournalTrans.insert();</span><br><span class="line">    ledgerJournalEngine.write(ledgerJournalTrans);&#125;</span><br></pre></td></tr></table></figure>

<p>When you modify Account&#x2F;Offset account fields in this example you need to call two methods(on ledgerJournalTrans and ledgerJournalEngine). This ensures that the line will be properly initialized from the Account&#x2F;Offset account field.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ledgerJournalTrans.modifiedField(fieldNum(LedgerJournalTrans, LedgerDimension));  </span><br><span class="line">ledgerJournalEngine.accountModified(LedgerJournalTrans);</span><br></pre></td></tr></table></figure>

<p>Voucher assignment here is processing in ledgerJournalEngine.write().</p>
<p>Also, an interesting flag here is LedgerJournalTrans.SkipBlockedForManualEntryCheck. It is useful when you don’t want to allow users to create manually lines with the same accounts as in your procedure.</p>
<h2 id="LedgerJournalTrans-defaultRow-method"><a href="#LedgerJournalTrans-defaultRow-method" class="headerlink" title="LedgerJournalTrans defaultRow() method"></a>LedgerJournalTrans defaultRow() method</h2><p>This is a new approach in D365FO and it uses a new defaultRow() table method. Data entities also call this method during the import process. Its idea is that we don’t control the sequence of different modifiedField method calls, we just populate the fields that we know, all other logic happens in the defaultRow() method.</p>
<p>Code for journal creation in this case:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="keyword">select</span> ledgerJournalTransOrig</span><br><span class="line">    order <span class="keyword">by</span> RecId</span><br><span class="line">    <span class="keyword">where</span> ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum</span><br><span class="line">&#123;</span><br><span class="line">    numLines++;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!ledgerJournalTable.RecId)</span><br><span class="line">    &#123;</span><br><span class="line">        ledgerJournalTable.clear();</span><br><span class="line">        ledgerJournalTable.initValue();</span><br><span class="line">        ledgerJournalTable.JournalName = _ledgerJournalTableOrig.JournalName;</span><br><span class="line">        ledgerJournalTable.initFromLedgerJournalName();</span><br><span class="line">        ledgerJournalTable.JournalNum = JournalTableData::newTable(ledgerJournalTable).nextJournalId();</span><br><span class="line">        ledgerJournalTable.Name = strFmt(<span class="string">&quot;Copy of %1, Date %2&quot;</span>, _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());</span><br><span class="line">        ledgerJournalTable.insert();</span><br><span class="line"></span><br><span class="line">        info(strFmt(<span class="string">&quot;Journal %1 created&quot;</span>, ledgerJournalTable.JournalNum));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ledgerJournalTrans.clear();</span><br><span class="line">    ledgerJournalTrans.initValue();</span><br><span class="line"></span><br><span class="line">    ledgerJournalTrans.JournalNum             = ledgerJournalTable.JournalNum;</span><br><span class="line">    ledgerJournalTrans.TransDate              = DEV::systemdateget();</span><br><span class="line">    ledgerJournalTrans.AccountType            = ledgerJournalTransOrig.AccountType;</span><br><span class="line">    ledgerJournalTrans.LedgerDimension        = ledgerJournalTransOrig.LedgerDimension;</span><br><span class="line">    ledgerJournalTrans.DefaultDimension       = ledgerJournalTransOrig.DefaultDimension;</span><br><span class="line"></span><br><span class="line">    ledgerJournalTrans.OffsetAccountType      = ledgerJournalTransOrig.OffsetAccountType;</span><br><span class="line">    ledgerJournalTrans.OffsetLedgerDimension  = ledgerJournalTransOrig.OffsetLedgerDimension;</span><br><span class="line">    ledgerJournalTrans.OffsetDefaultDimension = ledgerJournalTransOrig.OffsetDefaultDimension;</span><br><span class="line"></span><br><span class="line">    ledgerJournalTrans.CurrencyCode           =   ledgerJournalTransOrig.CurrencyCode;</span><br><span class="line">    ledgerJournalTrans.AmountCurCredit        =   ledgerJournalTransOrig.AmountCurCredit;</span><br><span class="line">    ledgerJournalTrans.AmountCurDebit         =   ledgerJournalTransOrig.AmountCurDebit;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//addition fields</span></span><br><span class="line">    ledgerJournalTrans.Approver           = HcmWorker::userId2Worker(curuserid());</span><br><span class="line">    ledgerJournalTrans.Approved           = NoYes::Yes;</span><br><span class="line">    ledgerJournalTrans.Txt                = ledgerJournalTransOrig.Txt;</span><br><span class="line">    ledgerJournalTrans.SkipBlockedForManualEntryCheck = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    ledgerJournalTrans.defaultRow();</span><br><span class="line">    DEV::validateWriteRecordCheck(ledgerJournalTrans);</span><br><span class="line">    ledgerJournalTrans.insert();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>You can find an example of this approach in the MCRLedgerJournal class (and the usage is here)</p>
<h2 id="Data-entity"><a href="#Data-entity" class="headerlink" title="Data entity"></a>Data entity</h2><p>We can also use a data entity for journal creation. Technically it produces the same result as the previous method because a data entity at the end will call a table defaultRow() method.</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> <span class="keyword">select</span> ledgerJournalTransOrig</span><br><span class="line">    order <span class="keyword">by</span> RecId</span><br><span class="line">    <span class="keyword">where</span> ledgerJournalTransOrig.JournalNum == _ledgerJournalTableOrig.JournalNum</span><br><span class="line">&#123;</span><br><span class="line">    numLines++;</span><br><span class="line">    <span class="keyword">select</span> dimensionCombinationEntity</span><br><span class="line">        <span class="keyword">where</span> dimensionCombinationEntity.RecId == ledgerJournalTransOrig.LedgerDimension;</span><br><span class="line">    <span class="keyword">select</span> dimensionCombinationEntityOffset</span><br><span class="line">        <span class="keyword">where</span> dimensionCombinationEntityOffset.RecId == ledgerJournalTransOrig.OffsetLedgerDimension;</span><br><span class="line"></span><br><span class="line">    ledgerJournalEntity.initValue();</span><br><span class="line">    ledgerJournalEntity.JournalBatchNumber     = journalNum;</span><br><span class="line">    ledgerJournalEntity.Description            = strFmt(<span class="string">&quot;Copy of %1, Date %2&quot;</span>, _ledgerJournalTableOrig.JournalNum, DEV::systemdateget());</span><br><span class="line">    ledgerJournalEntity.JournalName            = _ledgerJournalTableOrig.JournalName;</span><br><span class="line">    ledgerJournalEntity.LineNumber++;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//if you have string and want to convert to ID - DimensionDefaultResolver::newResolver(_dimensionDisplayValue).resolve();</span></span><br><span class="line">    <span class="comment">//AX &gt; General ledge &gt; Chart of accounts &gt; Dimensions &gt; Financial dimension configuration for integrating applications</span></span><br><span class="line">    ledgerJournalEntity.AccountType                 = ledgerJournalTransOrig.AccountType;</span><br><span class="line">    ledgerJournalEntity.AccountDisplayValue         = dimensionCombinationEntity.DisplayValue;</span><br><span class="line"></span><br><span class="line">    ledgerJournalEntity.OffsetAccountType           = ledgerJournalTransOrig.OffsetAccountType;</span><br><span class="line">    ledgerJournalEntity.OffsetAccountDisplayValue   = dimensionCombinationEntityOffset.DisplayValue;</span><br><span class="line"></span><br><span class="line">    ledgerJournalEntity.CreditAmount                = ledgerJournalTransOrig.AmountCurCredit;</span><br><span class="line">    ledgerJournalEntity.DebitAmount                 = ledgerJournalTransOrig.AmountCurDebit;</span><br><span class="line">    ledgerJournalEntity.CurrencyCode                = ledgerJournalTransOrig.CurrencyCode;</span><br><span class="line">    ledgerJournalEntity.TEXT                        = ledgerJournalTransOrig.Txt;</span><br><span class="line">    ledgerJournalEntity.TRANSDATE                   = ledgerJournalTransOrig.TransDate;</span><br><span class="line"></span><br><span class="line">    ledgerJournalEntity.defaultRow();</span><br><span class="line">    DEV::validateWriteRecordCheck(ledgerJournalEntity);</span><br><span class="line">    ledgerJournalEntity.insert();</span><br><span class="line"></span><br><span class="line">    journalNum = ledgerJournalEntity.JournalBatchNumber;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>As you see this method requires less code: we don’t even need to write code for the journal header creation, it is all handled by the data entity insert() method. Dimensions can be also specified as strings. However there are some limitations: sometimes data entity doesn’t contain all the table fields and it doesn’t support all account types.</p>
<h2 id="Performance-testing"><a href="#Performance-testing" class="headerlink" title="Performance testing"></a>Performance testing</h2><p>Let’s test the performance. First I created a test journal with the 1000 lines(<strong>createByCombination method</strong>) and then copied it using these 3 different methods. I got the following results:</p>
<table>
<thead>
<tr>
<th>Method</th>
<th>Time to create 1000 lines(sec)</th>
</tr>
</thead>
<tbody><tr>
<td>Using ledgerJournalEngine</td>
<td>30.54</td>
</tr>
<tr>
<td>Using DataEntity</td>
<td>33.09</td>
</tr>
<tr>
<td>Using Table defaultRow method</td>
<td>15.18</td>
</tr>
</tbody></table>
<p>There are some differences between the copy speed in my example, but it is caused by a different logic for the dimension creation, so the result is that all methods are almost equal and quite fast. In a real-life scenario, you can expect an insert speed 10-30 lines per second.</p>
<h2 id="Choosing-the-right-method-and-things-to-avoid"><a href="#Choosing-the-right-method-and-things-to-avoid" class="headerlink" title="Choosing the right method and things to avoid"></a>Choosing the right method and things to avoid</h2><p>In general, you have 2 options - to create a journal similar to the manual user entry or create it similar to the import procedure(for the second scenario choice between entity and table mostly depends on what input data you have and whether the entity supports all the required fields). So the choice between these two should be made by answering the question: if the user wants to create the same journal manually, does he use manual entry or data import? Use <a target="_blank" rel="noopener" href="https://github.com/TrudAX/XppTools/blob/3d69455f4b8157bc28bfc9560e9f70c8bacd634a/DEVTutorial/DEVTutorial/AxClass/DEVTutorialCreateLedgerJournal.xml#L196">createJournalUsingLedgerJournalEngine</a> as default, as it is more flexible.</p>
<p>Probably in D365FO it is better to avoid creation using JournalTransData classes or when you simply populate ledgerJournalTrans fields and call insert(). This initially can work, but later users may complain - e.g. “<em>Why when I create a journal manually and specify a vendor account the Due date field is calculated, but your procedure doesn’t fill it</em>“.</p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>You can download this class using the following link <a target="_blank" rel="noopener" href="https://github.com/TrudAX/XppTools/blob/master/DEVTutorial/DEVTutorial/AxClass/DEVTutorialCreateLedgerJournal.xml">createJournalUsingLedgerJournalEngine</a>. The idea is that you can use this code as a template when you have a task to create(or post) a ledger journal using X++. Comments are welcome.</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/LedgerJournalTrans/" rel="tag"><i class="fa fa-tag"></i> LedgerJournalTrans</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/07/08/d365-documentroutingconfiguration/" rel="prev" title="Document Routing Agent in D365 F&O">
                  <i class="fa fa-angle-left"></i> Document Routing Agent in D365 F&O
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/07/09/xpp-extendedvendtransandcusttrans/" rel="next" title="Extend CustTrans and VendTrans">
                  Extend CustTrans and VendTrans <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    
  
  <div class="comments">
  <script src="https://utteranc.es/client.js" repo="1YaoWei0/utterances-comments" issue-term="pathname" theme="github-dark" crossorigin="anonymous" async></script>
  </div>
  
  
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Willie Yao</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/1YaoWei0" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.3.0/pdfobject.min.js","integrity":"sha256-JJZNsid68vnh3/zyj0lY9BN5ynxVX/12XgOa1TlaYN0="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"forest","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.4.0/mermaid.min.js","integrity":"sha256-G8ouPAnw4zzMbnAenHnVz6h9XpKbNdOkrqTh7AadyHs="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script class="next-config" data-name="wavedrom" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/wavedrom.min.js","integrity":"sha256-INLAoJc6quTNfiMWkGZniYO2cxE8mHpddnLow1m6RFs="}}</script>
  <script class="next-config" data-name="wavedrom_skin" type="application/json">{"enable":true,"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/wavedrom/3.5.0/skins/default.js","integrity":"sha256-fduc/Zszk5ezWws2uInY/ALWVmIrmV6VTgXbsYSReFI="}}</script>
  <script src="/js/third-party/tags/wavedrom.js"></script>


  <script src="/js/third-party/pace.js"></script>


  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
